<!DOCTYPE html>
<html class="eClinic" lang="en">

<head>
  <link rel="stylesheet" href="index.css">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-Zenh87qX5JnK2Jl0vWa8Ck2rdkQ2Bzep5IDxbcnCeuOxjzrPF/et3URy9Bv1WTRi" crossorigin="anonymous">
  <link href='https://fonts.googleapis.com/css?family=Oswald:300' rel='stylesheet' type='text/css'>
  <link href='https://fonts.googleapis.com/css?family=Familjen Grotesk' rel='stylesheet'>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="icon" href="img/eClinicLogo-blue.png" type="image/x-icon" />
  <!-- MDB -->
  <!-- <link rel="stylesheet" href="css/mdb.min.css" /> -->
  <!-- for the logos in the sidebar -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <title>Semesters</title>
  <style>
    body {
      background-color: #e5e5e5;
    }

    .action .menu {
      position: absolute;
      top: 30px;
      right: 10px;
      padding: 0px 5px;
      background: #fff;
      width: 200px;
      box-sizing: 0 5px 25px rgba(0, 0, 0, 0.1);
      border-radius: 15px;
      transition: 0.5s;
      visibility: hidden;
      z-index: 999;
      opacity: 0;
      box-shadow: 1px 1px 10px 1px #ebebeb;
    }

    .action .menu::before {
      content: "";
      position: absolute;
      top: -5px;
      right: 28px;
      width: 20px;
      height: 20px;
      background: #fff;
      transform: rotate(45deg);
    }

    .action .menu ul li {
      list-style: none;
      padding: 16px 0;
      border-top: 1px solid rgba(0, 0, 0, 0.05);
      display: flex;
      align-items: center;
    }

    .action .menu ul li img {
      max-width: 20px;
      margin-right: 10px;
      opacity: 0.5;
      transition: 0.5s;
    }

    .action .menu ul li:hover img {
      opacity: 1;
    }

    .action .menu ul li a {
      display: inline-block;
      text-decoration: none;
      color: #555;
      font-weight: 500;
      transition: 0.5s;
    }

    .action .menu ul li:hover a {
      color: #0084bd;
    }

    .action {
      position: absolute;
      top: 10px;
      right: 20px;
    }

    #sidebarContainer {
      flex: 0 0 auto;
      width: 25%;
    }

    #rightContainer {
      flex: 0 0 auto;
      width: 75%;
      background-color: transparent;
    }

    .sidebar {
      flex-direction: column !important;
    }

    .sidebar li {
      display: inline-block;
    }

    #closeFacultyList {
      display: none;
    }

    .firstMiddleRow {
      width: 65%;
      margin-left: 4px;
      margin-right: 2px;
    }

    .secondMiddleRow {
      width: 33%;
      margin-right: 2px;
    }

    .footer {
      position: absolute;
      padding: 30px;
      text-align: left;
      bottom: 0;
      margin-top: 10px;
      color: #fff;
    }

    #navbarSupportedContent .nav-link:hover {
      color: #0084BD;
    }

    #popup {
      display: block;
    }

    @media screen and (max-width: 992px) {

      body {
        background-color: #fff;
      }

      .firstMiddleRow,
      .secondMiddleRow {
        border: 0;
        width: 100%;
        margin: 0;
      }

      .action {
        display: none;
      }

      .xlogo {
        display: none !important;
      }

      #rightContainer {
        width: 99%;
      }

      #closeFacultyList {
        display: block;
      }

      #popup {
        margin: 0;
        border: 0;
        padding: 5px;
        display: none;
        position: absolute;
        width: 100%;
        height: 100%;
        left: 0;
        top: 0;
      }

      .sidebar {
        background-color: white;
        height: auto !important;
        margin-top: 50px;
        width: 100%;
        border: 1px #ccc solid;
        padding-bottom: 20px;
      }

      #sidebarContainer {
        background-color: transparent;
        position: absolute !important;
        left: 0;
        top: 0;
        flex: 0 0 auto;
        width: 100%;
      }





      #navbarSupportedContent {
        /* z-index: 100; */
        /* margin-top: 20; */
        background-color: #fff;
        color: #000 !important;
      }

      #navbarSupportedContent .nav-link {
        color: black;
      }


    }



    th {
      border-style: hidden !important;
    }

    /* body {
      padding: 3;
      background: #e5e5e5;
      overflow-x: hidden;
    } */


    .mytitle {
      color: #0084bd;
    }



    #mytable {
      border-collapse: collapse;
      text-align: center;
    }

    #mytable td,
    #mytable th {
      border: 1px solid #ddd;
      /* padding: 2px 90px; */
    }

    #mytable tr:nth-child(even) {
      background-color: #f2f2f2;
    }

    #mytable tr:hover {
      background-color: #ddd;
    }

    #mytable th {
      /* padding-top: 12px;
    padding-bottom: 12px; */
      text-align: center;
      background-color: #0084bd;
      color: white;
    }


    .logbut {
      background-image: linear-gradient(#0084BD 0%, #0084BD 100%);


    }


    .logbut:hover {
      background-image: linear-gradient(#037caf 0%, #037caf 100%);

    }
  </style>

</head>

<body>


  <main class="relative">


    <!-- Start profile icons  -->
    <div class="action">
      <div class=" profile" onclick="menuToggle();">
        <img src="img/user.png" />
      </div>
      <div class="menu">
        <ul>
          <li>
            <img src="img/logout.png" /><a href="#" class="xlogout" onclick="">Log Out</a>
          </li>
          <li>
            <img src="img/lock.png" /><a href="resetinner.html">Reset Password</a>
          </li>
        </ul>
      </div>
    </div>
    <!-- end profil icons  -->


    <div class="container-fluid" style="margin-top: 50px;">
      <div class="row">
        <!--***************************************** SHOW DATA IN HERE AFTER RETRIVING****************************************  -->
        <div id="sidebarContainer">
          <!-- side menu -->
          <nav class=" navbar navbar-expand-lg ">
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
              data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false"> <i
                class='navbar-toggler-icon' style='color:#000'></i>
            </button>


            <div class="collapse navbar-collapse" id="navbarSupportedContent">

              <ul class="sidebar navbar-nav mr-auto">
                <li class="xlogo">
                  <img class=" logo" src="img/logo.png" alt="logo brand" height="auto" width="200px"
                    style="margin-bottom:20px">
                </li>
                <li class="nav-item active"><a class="nav-link" href="index.html"><i
                      class="fa fa-fw fa-home"></i>Home</a></li>
                <li class="nav-item "><a class="nav-link" href="semesters.html"><i class="fa fa-calendar"></i>
                    Semesters</a></li>
                <li class="nav-item "><a class="nav-link" href="faculty.html"><i class="fa fa-group"></i> Faculty
                    Members
                    Speciality </a></li>
                <li class="nav-item "><a class="nav-link" href="GPCategory.html"><i
                      class="fa fa-graduation-cap"></i>Graduation Projects Category</a></li>
                <li class="nav-item "><a class="nav-link" href="timeframe.html"><i class="fa fa-clock-o"></i> Help Desk
                    Dates</a></li>
                <li class="nav-item d-block d-lg-none"><a class="nav-link logout" href="#"><i
                      class="fa fa fa-sign-out"></i> Logout</a>
                </li>
                <li class="nav-item d-block d-lg-none"><a class="nav-link " href="resetinner.html"><i
                      class="fa fa-refresh"></i>
                    Reset Password</a></li>

                <li class="footer display-10 d-none d-lg-block">
                  Copyright &copy; All
                  Rights
                  Reserved to
                  King Saud University.Made by eClinic Teams
                </li>
              </ul>
            </div>

          </nav>
        </div>

        <div class="col-9 mt-lg-2" id="rightContainer">
          <div class="row">
            <!-- middle  -->
            <div class="p-2 card firstMiddleRow">
              <div class="flex-column flex-sm-row  d-flex justify-content-between">
                <h4 class="">Semesters</h4>

                <div class="d-flex justify-content-end">
                  <input type="button" value="Add New Semester" id="add" class=" logbut btn btn-primary btn-lg"
                    style="padding-left: 0.5rem; padding-right: 0.5rem; padding-bottom: 0.2rem; padding-top: 0.2rem; font-size: 18px;">
                </div>
              </div>

              <div style="display: none;" class="card border-warning mt-5 m-3 p-2 text-bg-warning" id="noItems">
                There is curretnly no semester.
              </div>
              <div class="table-responsive">
                <table class="show_info card-body table" style=" display: none;" id="mytable">

                  <thead>
                    <th style="width:50%"> Semester</th>
                    <th style="width:70%"> Year</th>
                    <th style="width:10%"></th>
                  </thead>
                  <tbody id="show_data">

                  </tbody>

                </table>
              </div>
            </div>

            <!-- right form -->
            <div class="card secondMiddleRow" id="popup">
              <!-- start faculty list -->
              <div id="facultyList" class="m-3" style="display: none;">
                <button type="button" id="closeFacultyList" class="btn-close btn-close mb-4"
                  aria-label="Close"></button>
                <select id="specialityList" class="form-select mb-2"></select>
                <ul id="facultyListData" class="list-group m-1">

                </ul>
              </div>
              <!-- / end faculty list -->
              <div style="display: none;" class="card border-success mt-5 m-3 p-2 text-success" id="message"></div>

              <form id="semester-year" class="col" style="display: none;">
                <div class="my-3">
                  <label class="form-label" style="margin-bottom: 0.2px;">Semester</label>

                  <select class="semester form-select" name="semester" id="semester">
                    <option selected disabled>choose a semester</option>
                    <option value="1st">1st</option>
                    <option value="2nd">2nd</option>
                    <option value="3rd">3rd</option>

                  </select>
                </div>

                <label class="form-label" style="margin-bottom: 0.2px;"> Year</label>


                <div class="input-group mb-0">

                  <select class="years form-select" name="year" id="firstyear">
                    <option selected disabled>choose a year</option>
                  </select>
                  <span class="input-group-text">/</span>
                  <select class="form-select" name="year" id="secondyear" disabled>
                    <option selected disabled>choose a year</option>
                  </select>
                </div>

                <div class="d-flex justify-content-evenly">
                  <input type="button" value="ADD" id="addtodb" class="mt-3 logbut btn btn-primary btn-lg"
                    style="padding-left: 1.2rem; padding-right: 1.4rem; padding-bottom: 0.2rem; padding-top: 0.2rem; font-size: 18px;"
                    style="display: none; ">
                  <input type="button" value="UPDATE" id="updatetodb" class="mt-3 logbut btn btn-primary btn-lg"
                    style="padding-left: 0.5rem; padding-right: 0.5rem; padding-bottom: 0.2rem; padding-top: 0.2rem; font-size: 18px;"
                    style="display: none;" data-ref="" data-current-value="">
                  <input type="button" value="CANCEL" id="cancle" class="mt-3 btn btn-secondary"
                    style="display: none; ">
                </div>
              </form>
            </div>
          </div>
        </div>
      </div>
    </div>

  </main>


  <!-- ****************************************End FrontEnd ***********************************************************  -->






  <!-- ******************************************link with firestore**************************************************** -->

  <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-OERcA2EqjJCMA+/3y+gxIOqMEjwtxJY7qPCqsdltbNJuaOe923+mo//f6V8Qbsw3"
    crossorigin="anonymous"></script>
  <!-- <script type="text/javascript" src="js/mdb.min.js"></script> -->
  <script type="module">
    // Import the functions you need from the SDKs you need
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.12.1/firebase-app.js";
    // TODO: Add SDKs for Firebase products that you want to use
    // https://firebase.google.com/docs/web/setup#available-libraries
    import { getFirestore, doc, collection, query, where, getDocs, getDoc, addDoc, updateDoc } from "https://www.gstatic.com/firebasejs/9.12.1/firebase-firestore.js";
    import { getAuth, signOut, onAuthStateChanged, sendPasswordResetEmail } from "https://www.gstatic.com/firebasejs/9.12.1/firebase-auth.js"; //import for authentication +signout
    // Your web app's Firebase configuration
    const firebaseConfig = {
      apiKey: "AIzaSyD6JcSscRU6XaF3SaCF_U3ggXAFYUnKKq8",
      authDomain: "eclinic-d5dec.firebaseapp.com",
      projectId: "eclinic-d5dec",
      storageBucket: "eclinic-d5dec.appspot.com",
      messagingSenderId: "148819771062",
      appId: "1:148819771062:web:0cef59ac00e9c176247017"

    };

    // ************************************************** Initialize Firebase**********************************

    const app = initializeApp(firebaseConfig);
    const db = getFirestore();
    const auth = getAuth()


    setTimeout(() => {
      if (document.getElementById("noItems").style.display == "none")
        document.getElementById("mytable").style.display = "block";
    }, 2000);

    //get all faculty members of one semester
    async function getFaculty (semesterId, buttonElem) {


      //fix duplicated loading.
      if (document.getElementById("facultyList").style.display != 'none') {
        return;
      }
      document.getElementById("facultyList").style.display = "block";
      document.getElementById("facultyListData").dataset.uniqueid = semesterId;
      document.getElementById('specialityList').style.display = 'none';
      document.getElementById("facultyListData").innerHTML = '<div style="text-align:center"><i class="fa fa-spinner fa-spin fa-3x fa-fw"></i></div>';


      //get a fresh facultymembers from database
      const docSnap = await getDoc(doc(db, "semester", semesterId));

      var semesterFaculty;
      if (!docSnap.exists()) {
        semesterFaculty = [];
      } else {
        const details = docSnap.data();
        semesterFaculty = details.facultymembers || [];
      }
      let found = semesterFaculty.length > 0;

      document.getElementById("facultyListData").innerHTML = "";


      let currentItem = 1;
      await semesterFaculty.forEach(async (docc) => {
        console.log("doc.faculty ", docc.faculty);
        const facultyDocRef = await getDoc(docc.faculty);
        let facultyData = facultyDocRef.data();
        let specialityList = "";
        let specialityListIDs = '';
        console.log("doc.specialty ", docc.specialty);
        if (docc.specialty != null) {
          for (let index = 0; index < docc.specialty.length; index++) {
            const element = docc.specialty[index];
            const qqSnapshot = await getDoc(docc.specialty[index]);
            let sp = qqSnapshot.data();
            specialityList += (specialityList != "" ? ", " : "") + sp.specialityname;
            specialityListIDs += (specialityListIDs != "" ? "," : '') + '"' + qqSnapshot.id + '"';
          };
        }

        if (document.getElementById("facultyListData").dataset.uniqueid == semesterId) {
          document.getElementById("facultyListData").innerHTML += '<li data-sp=\'[' + specialityListIDs + ']\' class="spitem list-group-item d-flex justify-content-between align-items-center">' + facultyData.firstname + ' ' + facultyData.lastname + '<span class="badge rounded-pill" style="background-color:#0084bd; white-space: normal!important;">' + specialityList + '</span></li>';
        }
        if (currentItem == semesterFaculty.length) {
          document.getElementById('specialityList').disabled = false;
        }

        currentItem++;
      });



      if (!found) {
        buttonElem.classList.replace('btn-primary', 'btn-secondary');
        document.getElementById('specialityList').style.display = 'none';
        document.getElementById('facultyListData').innerHTML += '<li class="list-group-item list-group-item-warning">No faculty is found to be listed under this semester!</li>';
      } else {
        buttonElem.classList.replace('btn-secondary', 'btn-primary');
        document.getElementById('specialityList').style.display = 'block';
        document.getElementById('facultyListData').innerHTML += '<li class="list-group-item list-group-item-info text-center text-white" style="background-color:#0084bd;">Semester Faculty List</li>';
        document.getElementById('facultyListData').innerHTML += '<li id="no-faculty" class="list-group-item list-group-item-warning" style="display:none">No faculty is found to be listed under this sepciality!</li>';

      }

      document.getElementById("semester-year").style.display = "none";
      document.getElementById("facultyList").style.display = "block";

      return true;
    }

    // *********************************INITIALIZE ALL VARIBALES*********************************************
    document.onreadystatechange = async function () {
      let addnewbtn = document.getElementById("add");
      let addDBbtn = document.getElementById("addtodb");
      let updatebtn = document.getElementsByClassName("update");
      let showFacultyListbtn = document.getElementsByClassName("show-faculty");
      let updateDBbtn = document.getElementById("updatetodb");
      let canclebtn = document.getElementById("cancle");
      // **********************FOR DIV ***************************************************************************
      let addUpdatediv = document.getElementById("semester-year");
      let facultylistdiv = document.getElementById("facultyList");
      // ********************** FOR DROP DOWN ********************************************************************
      let semesterDropdown = document.getElementById("semester");
      let dateDropdown1 = document.getElementById("firstyear");
      let dateDropdown2 = document.getElementById("secondyear");
      let box = document.getElementById("show_data");
      let hasNoItems = true;
      let specialityList = document.getElementById("specialityList");
      // let semestersFacultyList = {};
      // ********************** get all docs********************************************************************

      //get all specialities
      const specialityCollection = query(collection(db, "facultyspeciality"));
      const specialityDocs = await getDocs(specialityCollection);
      specialityList.innerHTML += '<option value="0" selected>All</option>';
      specialityDocs.forEach((doc) => {
        let detail = doc.data();
        specialityList.innerHTML += '<option value="' + doc.id + '">' + detail.specialityname + '</option>';
      });

      const q = query(collection(db, "semester"));
      const querySnapshot = await getDocs(q);
      querySnapshot.forEach((doc) => {
        hasNoItems = false;
        // doc.data() is never undefined for query doc snapshots
        let detail = doc.data();
        let text = detail.semestername;
        const myArray = text.split(" ");

        let semestersFacultyMemebers = detail.facultymembers ?? [];

        box.innerHTML += '<tr>' + '<td><span id="semester-' + doc.id + '">' + myArray[0] + '</span></td>' + '<td><span id="year-' + doc.id + '"">' + myArray[1] + '</span></td>' +
          '<td class="d-flex justify-content-between">' +
          '<button id="' + doc.id + '-ref" type="button" class=" update logbut btn btn-primary mx-2" style="border:0;font-size: 18px;" data-ref="' + doc.id + '">✎</button>' +
          '<button id="' + doc.id + '-sesmster" type="button" class=" show-faculty btn ' + (semestersFacultyMemebers.length == 0 ? 'btn-secondary' : 'logbut btn-primary') + ' mx-2" style="border:0"  data-semester="' + doc.id + '"><i class="fa fa-users" aria-hidden="true"></i></button>' +
          '</td>' + '</tr>';
      });

      hasItemsCheck();




      // ********************** set years********************************************************************

      let earliestYear = 2050;
      let currentYear1 = new Date("2018-01-01").getFullYear();
      while (currentYear1 <= earliestYear) {
        var dateOption = document.createElement("option");
        dateOption.text = currentYear1;
        dateOption.value = currentYear1;
        dateDropdown1.add(dateOption);
        currentYear1 += 1;
      }

      let currentYear2 = new Date("2018-01-01").getFullYear();
      while (currentYear2 <= earliestYear) {
        var dateOption = document.createElement("option");
        dateOption.text = currentYear2;
        dateOption.value = currentYear2;
        dateOption.classList.add("dropdown-option-" + currentYear2);
        dateOption.disabled = true;
        dateOption.hidden = true;
        dateDropdown2.add(dateOption);
        currentYear2 += 1;
      }
      // ********************** reset function********************************************************************
      const resetForm = () => {
        semesterDropdown.value = "choose a semester"

        $('#secondyear option').attr("disabled", true).attr('hidden', true);

        dateDropdown1.value = "choose a year"
        dateDropdown2.value = "choose a year"
        dateDropdown2.disabled = true;
      }

      dateDropdown1.addEventListener('change', function () {
        $('#secondyear option').attr("disabled", true).attr('hidden', true);

        if (dateDropdown1.selectedIndex > 0) {
          dateDropdown2.disabled = false;
          dateDropdown2.options[dateDropdown1.selectedIndex].disabled = false;
          dateDropdown2.options[dateDropdown1.selectedIndex].hidden = false;
          if (dateDropdown2.options[dateDropdown1.selectedIndex + 1]) {
            dateDropdown2.options[dateDropdown1.selectedIndex + 1].disabled = false;
            dateDropdown2.options[dateDropdown1.selectedIndex + 1].hidden = false;
          }

          dateDropdown2.selectedIndex = dateDropdown1.selectedIndex;
        }
      });
      document.getElementById("closeFacultyList").addEventListener("click", function () {
        document.getElementById("popup").style.display = "none";
      });
      // ********************** 1-CLICK ADD BUTTON WITH VALUE(ADD NEW SEMESTER/YEAR)************************************
      addnewbtn.addEventListener('click', function () {
        document.getElementById("popup").style.display = "block";
        resetForm();

        addUpdatediv.style.display = "block";
        addDBbtn.style.display = "block";
        updateDBbtn.style.display = "none";
        facultylistdiv.style.display = "none";
        canclebtn.style.display = "block";
      });

      // ********************** CLICK CANCLE BUTTON WITH VALUE(CANCLE)****************************************************

      canclebtn.addEventListener('click', function () {
        {
          if (confirm("Are you sure you want to cancle your work?") == true) {
            addUpdatediv.style.display = "none";
            document.getElementById("popup").style.display = "none";

            resetForm();
          }
          else
            return false;
        }
      })
      specialityList.addEventListener('change', function (event) {
        const items = document.querySelectorAll('.spitem');
        let foundItems = 0;
        items.forEach(p => {
          let x = JSON.parse(p.dataset.sp);

          if (x.includes(specialityList.value) || specialityList.value == 0) {
            p.style.display = '';
            foundItems++;
          } else {
            p.setAttribute('style', 'display:none !important');
          }
        });
        console.log(foundItems)

        if (foundItems == 0) {
          document.getElementById('no-faculty').style.display = 'block'
        } else {
          document.getElementById('no-faculty').style.display = 'none'
        }
      });


      // ********************** for yallow alert ****************************************************
      function hasItemsCheck () {
        if (hasNoItems) {
          document.getElementById('noItems').style.display = 'block';
          document.getElementById('mytable').style.display = 'none';
        } else {
          document.getElementById('mytable').style.display = 'block';
          document.getElementById('noItems').style.display = 'none';
        }
      }
      // ********************** for green alert ****************************************************
      function successMessage (message) {
        document.getElementById('message').innerHTML = message;
        document.getElementById('message').style.display = "block";

        setTimeout(() => {
          var elems = document.querySelectorAll("tr.table-success");

          [].forEach.call(elems, function (el) {
            el.classList.remove("table-success");
          });
          document.getElementById('message').style.display = "none";
        }, 5000);
      }
      // ********************** for checking drop down ****************************************************
      function checkSemesterDates () {
        if (semesterDropdown.value == "choose a semester") {
          alert("please choose a semester");
          return '';
        }

        if (dateDropdown1.value == "choose a year") {
          alert("please choose the first year");
          return '';
        }
        if (dateDropdown2.value == "choose a year") {
          alert("please choose the second year");
          return '';
        }
        let extra = '';

        if (dateDropdown2.value != "choose a year") {
          if (dateDropdown2.value < dateDropdown1.value) {
            alert("the second year must be after the first year");
            return '';
          }

          extra = '/' + dateDropdown2.value;
        }

        if (dateDropdown2.value != "choose a year") {
          if (dateDropdown2.value - 1 != dateDropdown1.value & dateDropdown2.value - 1 > dateDropdown1.value) {
            alert("The duration between the first year and the second year should be one year");
            return '';
          }

          extra = '/' + dateDropdown2.value;
        }

        return semesterDropdown.value + " " + dateDropdown1.value + extra;
      }

      // ********************** exists docs ****************************************************
      const docExistsOrNot = async (semesteryearname) => {
        var found = false;
        const qadd = query(collection(db, "semester"));
        const querySnapshotadd = await getDocs(qadd);
        querySnapshotadd.forEach((doc) => {
          if (doc.data().semestername == semesteryearname) {
            found = true;
          }
        });

        return found;
      }

      // ********************** 1-CLICK ADD BUTTON WITH VALUE(ADD)********************************************************

      addDBbtn.addEventListener('click', async function () {

        let semesteryearname = checkSemesterDates();

        if (semesteryearname == '') {
          return;
        }
        addDBbtn.setAttribute("disabled", "disabled");

        // ********************** 3-CHECK IF THE SEMESTER ADDED BEFORE************************************
        let found = await docExistsOrNot(semesteryearname);
        if (found) {
          alert("This semester is already added");
        } else {

          if (semesteryearname != "") {
            const docRef = await addDoc(collection(db, "semester"), {
              semestername: semesteryearname,
              enddate: null,
              startdate: null,

            });

            const myArray = semesteryearname.split(" ");

            box.innerHTML += '<tr class="table-success">' + '<td><span id="semester-' + docRef.id + '">' + myArray[0] + '</span></td>' + '<td><span id="year-' + docRef.id + '"">' + myArray[1] + '</span></td>' +
              '<td class="d-flex justify-content-between">' +
              '<button id="' + doc.id + '-ref" type="button" class=" update logbut btn btn-primary mx-2" style=" border:0;font-size: 18px;" data-ref="' + docRef.id + '">✎</button>' +
              '<button id="' + doc.id + '-semester" type="button" class=" show-faculty  btn btn-secondary mx-2" style=" border:0"  data-semester="' + docRef.id + '"><i class="fa fa-users" aria-hidden="true"></i></button>' +
              '</td>' + '</tr>';

            document.getElementById("semester-year").style.display = "none";
            hasNoItems = false;
            hasItemsCheck();
            successMessage('Semester has been added successfully');
            setTimeout(() => {
              document.getElementById("popup").style.display = "none";
            }, 2000);
            addUpdateEvents();
          }
        }
        document.getElementById("addtodb").removeAttribute("disabled");
      })

      // ********************** CLICK UPDATE BUTTON WITH VALUE(edit) WITH UNIQUE ID**********************

      const addUpdateEvents = () => {
        for (var i = 0; i < updatebtn.length; i++) {
          showFacultyListbtn.item(i).addEventListener('click', async function (event) {
            document.getElementById("popup").style.display = "block";
            document.getElementById("facultyList").style.display = "none";
            var elem = event.target;
            if (!elem) {
              elem = event.currentTarget;
              if (elem.tagName == "li") {
                elem = event.parentElement.target;
                if (!elem) {
                  elem = event.parentElement.currentTarget;
                }
              }
            }


            let docSemester = event.target.dataset.semester;
            if (!docSemester) {
              docSemester = event.currentTarget.dataset.semester;
            }

            console.log("docSemester:show-press:" + docSemester);
            specialityList.value = 0;
            document.getElementById('specialityList').disabled = true;
            await getFaculty(docSemester, elem);
          });

          updatebtn.item(i).addEventListener('click', async function (event) {
            document.getElementById("popup").style.display = "block";

            addUpdatediv.style.display = "block";
            addDBbtn.style.display = "none";
            updateDBbtn.style.display = "block";
            canclebtn.style.display = "block";
            facultylistdiv.style.display = "none";

            // **************************HOW I CAN RETRIVE DATA IN DROP DOWN TO UPDATE IT ? ********************


            let docRef = event.target.dataset.ref;
            if (!docRef) {
              docRef = event.currentTarget.dataset.ref;
            }
            console.log("docref:edit-press:", docRef);


            const docSnap = await getDoc(doc(db, "semester", docRef));

            if (docSnap.exists()) {
              console.log("Document data:", docSnap.data());
              const details = docSnap.data();
              updateDBbtn.setAttribute('data-ref', docRef);
              updateDBbtn.setAttribute('data-current-value', details.semestername);

              const semester = details.semestername.split(" ");


              if (semester[1].indexOf('/') != -1) {
                const dates = semester[1].split("/");
                dateDropdown1.value = dates[0];
                dateDropdown2.value = dates[1];
              } else {
                dateDropdown1.value = semester[1];
                dateDropdown2.value = 'choose a year';
              }


              console.log("dateDropdown2.selectedIndex" + dateDropdown2.selectedIndex);

              $('#secondyear option').attr("disabled", true).attr('hidden', true);

              dateDropdown2.disabled = false;
              dateDropdown2.options[dateDropdown2.selectedIndex].disabled = false;
              dateDropdown2.options[dateDropdown2.selectedIndex].hidden = false;
              //2024/2025: 1: 2024 2:2025, 
              if (dateDropdown2.selectedIndex == dateDropdown1.selectedIndex) {
                if (dateDropdown2.options[dateDropdown2.selectedIndex + 1]) {
                  dateDropdown2.options[dateDropdown2.selectedIndex + 1].disabled = false;
                  dateDropdown2.options[dateDropdown2.selectedIndex + 1].hidden = false;
                }
              } else {
                if (dateDropdown2.options[dateDropdown2.selectedIndex - 1]) {
                  dateDropdown2.options[dateDropdown2.selectedIndex - 1].disabled = false;
                  dateDropdown2.options[dateDropdown2.selectedIndex - 1].hidden = false;
                }
              }


              semesterDropdown.value = semester[0];
            } else {
              console.log("No such document! ref: " + id);
            }
          })
        }
      };

      addUpdateEvents();

      //************************ CLICK UPDATE BUTTON WITH VALUE(UPDATE)**************************************


      updateDBbtn.addEventListener('click', async function () {
        let semesteryearname = checkSemesterDates();
        console.log('z:semesteryearname:updateDBbtn.even: ' + semesteryearname);

        if (semesteryearname == '') {
          return;
        }


        updateDBbtn.setAttribute("disabled", "disabled");

        let docCurrentValue = updateDBbtn.getAttribute('data-current-value');

        if (docCurrentValue == semesteryearname) {
          alert("You didn't make any change ...");
          updateDBbtn.removeAttribute("disabled");
          return;
        }

        let found = await docExistsOrNot(semesteryearname);
        if (found) {
          alert("This semester is already in the database. Choose Another name.");
          updateDBbtn.removeAttribute("disabled");
          return;
        }

        console.log('x:semesteryearname:updateDBbtn.even: ' + semesteryearname);

        let docRef = updateDBbtn.getAttribute('data-ref');

        console.log('docRef:updateDBbtn.even: ' + docRef);

        try {
          await updateDoc(doc(db, "semester", docRef), {
            semestername: semesteryearname
          });
        } catch (e) {
          //in case there is an error! we dont update the page.
          alert('We caught an error during update, refresh the page and try again!');
          return;
        }

        //update page
        const myArray = semesteryearname.split(" ");
        console.log('docRef:updateDBbtn.myArray: ' + myArray[0] + ',' + myArray[1]);

        document.getElementById('semester-' + docRef).innerHTML = myArray[0];
        document.getElementById('year-' + docRef).innerHTML = myArray[1];
        addUpdatediv.style.display = "none";

        document.getElementById('semester-' + docRef).parentNode.parentElement.classList.add('table-success');

        successMessage('This semester has been updated successfully');
        setTimeout(() => {
          document.getElementById("popup").style.display = "none";
        }, 2000);
        updateDBbtn.removeAttribute("disabled");
      });


    };
    ////////////////////////////////////////logout/////////////////////////////////
    $('body').on('click', '.xlogout, .logout', () => {
      const conf = confirm("Are you sure you want to log out?");

      if (conf === true) {
        signOut(auth)
          .then(() => {
            console.log("user log out")
          })
          .catch((err) => {
            console.log(err.message)
          })

        window.location.replace("login.html")
      }


    });

    /////////////////////////there is authentication for each page  /////////////////////////
    onAuthStateChanged(auth, (user) => {
      if (user) {
        // console.log("the same user")
        uid = user.uid;
      }
      else {
        signOut(auth)
          .then(() => {
            window.location.replace("login.html")
            console.log("user log out")
          })
          .catch((err) => {
            console.log(err.message)
          })
      }
      console.log("the user status change :", user)
    })


  </script>
  <script>
    // start: java sript for profile icons 
    function menuToggle () {
      const toggleMenu = document.querySelector(".menu");
      toggleMenu.classList.toggle("active");
    }
        // End: java sript for profile icons
  </script>


</body>

</html>